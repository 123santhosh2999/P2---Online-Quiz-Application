<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" 
      layout:decorate="~{layout}">
<head>
    <title th:text="'Taking Quiz: ' + ${quiz.title}">Taking Quiz</title>
</head>
<body>
    <div layout:fragment="content">
        <!-- Quiz Header -->
        <div class="row mb-4">
            <div class="col-md-8">
                <h2 th:text="${quiz.title}">Quiz Title</h2>
                <p class="text-muted" th:text="${quiz.description}">Quiz Description</p>
            </div>
            <div class="col-md-4 text-end">
                <div class="card bg-info text-white">
                    <div class="card-body">
                        <h5 class="mb-0">Time Remaining</h5>
                        <h3 id="timer">00:00</h3>
                    </div>
                </div>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="progress">
                    <div class="progress-bar" role="progressbar" style="width: 0%" id="progressBar">
                        Question 1 of <span th:text="${#lists.size(questions)}">10</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quiz Form -->
        <form th:action="@{/quiz/submit/{id}(id=${attempt.id})}" method="post" id="quizForm">
            <div th:each="question, iterStat : ${questions}" class="question-container" 
                 th:style="${iterStat.index == 0} ? 'display: block' : 'display: none'"
                 th:data-question-index="${iterStat.index}">
                
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            Question <span th:text="${iterStat.index + 1}">1</span>
                            <span class="badge bg-primary" th:text="${question.marks} + ' marks'">1 marks</span>
                        </h5>
                    </div>
                    <div class="card-body">
                        <p class="question-text" th:text="${question.questionText}">Question text goes here</p>
                        
                        <div class="answers-container">
                            <div th:each="answer : ${question.answers}" class="form-check mb-2">
                                <input class="form-check-input" type="radio" 
                                       th:name="'question_' + ${question.id}" 
                                       th:value="${answer.id}"
                                       th:id="'answer_' + ${answer.id}">
                                <label class="form-check-label" th:for="'answer_' + ${answer.id}">
                                    <span th:text="${answer.answerText}">Answer option</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="row">
                <div class="col-6">
                    <button type="button" class="btn btn-secondary" id="prevBtn" style="display: none;">
                        <i class="fas fa-arrow-left me-2"></i>Previous
                    </button>
                </div>
                <div class="col-6 text-end">
                    <button type="button" class="btn btn-primary" id="nextBtn">
                        Next<i class="fas fa-arrow-right ms-2"></i>
                    </button>
                    <button type="submit" class="btn btn-success" id="submitBtn" style="display: none;">
                        <i class="fas fa-check me-2"></i>Submit Quiz
                    </button>
                </div>
            </div>
        </form>

        <!-- Quiz Navigation Sidebar -->
        <div class="position-fixed top-50 end-0 translate-middle-y" style="z-index: 1000;">
            <div class="card" style="width: 200px;">
                <div class="card-header">
                    <h6 class="mb-0">Questions</h6>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2" id="questionNav">
                        <button th:each="question, iterStat : ${questions}" 
                                type="button" 
                                class="btn btn-outline-primary btn-sm question-nav-btn"
                                th:data-question-index="${iterStat.index}"
                                th:text="${iterStat.index + 1}">
                            1
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Auto-submit warning modal -->
        <div class="modal fade" id="timeWarningModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header bg-warning">
                        <h5 class="modal-title">Time Warning</h5>
                    </div>
                    <div class="modal-body">
                        <p>You have less than 5 minutes remaining!</p>
                        <p>Make sure to complete all questions.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Continue</button>
                    </div>
                </div>
            </div>
        </div>

        <script th:inline="javascript">
            const timeLimit = /*[[${quiz.timeLimit}]]*/ 0; // in minutes
        </script>
    </div>
</body>
</html>